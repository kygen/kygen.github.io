  :root{
    --bg:#0f172a; --panel:#111827; --soft:#1f2937; --muted:#334155; --text:#e5e7eb;
    --accent:#38bdf8; --accent2:#22d3ee; --ok:#10b981; --warn:#f59e0b; --danger:#ef4444;
    --shadow: 0 10px 25px rgba(0,0,0,.35); --radius: 16px;

    --space-1: clamp(6px, 0.9vw, 10px);
    --space-2: clamp(10px, 1.2vw, 14px);
    --space-3: clamp(12px, 1.6vw, 18px);
    --space-4: clamp(16px, 2vw, 24px);
    --space-5: clamp(18px, 2.4vw, 28px);
    --round: 12px; --tap: 44px;
    --fs-12: clamp(11px, 1.2vw, 12px);
    --fs-13: clamp(12px, 1.25vw, 13px);
    --fs-14: clamp(13px, 1.4vw, 14px);
    --fs-15: clamp(14px, 1.6vw, 15px);
    --fs-16: clamp(14px, 1.8vw, 16px);
    --fs-18: clamp(15px, 2.1vw, 18px);
    --fs-20: clamp(16px, 2.4vw, 20px);
    --fs-24: clamp(18px, 3vw, 24px);
  }
  @media (min-width: 1200px){
    :root{ --fs-16:17px; --fs-18:19px; --space-3:20px; --space-4:28px; --space-5:32px; }
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Kufi Arabic", "Noto Sans Arabic", Tahoma, Arial, sans-serif;
    background:
      radial-gradient(1200px 600px at 10% -10%, rgba(56,189,248,.15), transparent 60%),
      radial-gradient(1200px 600px at 110% 20%, rgba(34,211,238,.12), transparent 60%),
      var(--bg);
    color:var(--text); line-height:1.65; font-size: var(--fs-16);
  }
  header{
    padding: var(--space-5) var(--space-3) var(--space-2);
    position:sticky; top:0; z-index:10;
    background:linear-gradient(180deg, rgba(15,23,42,.95), rgba(15,23,42,.75));
    backdrop-filter: blur(6px);
    border-bottom:1px solid rgba(255,255,255,.06);
  }
  .container{max-width:min(98vw, 1800px); margin:0 auto; padding:0 var(--space-3);}
  .title{display:flex; align-items:center; gap:var(--space-2); flex-wrap:nowrap;}
  .logo{
    width: clamp(48px, 5vw, 60px);
    height: clamp(48px, 5vw, 60px);
    border-radius:12px;
    box-shadow:var(--shadow);
    object-fit:cover;
  }
  .subtitle{opacity:.9; font-size:var(--fs-14); margin-top:4px}
  .grid{
    display:grid; gap:var(--space-3); margin:var(--space-3) 0 var(--space-4);
    grid-template-columns: 1fr 3fr; align-items:stretch;
  }
  @media (max-width:1100px){ .grid{grid-template-columns:1fr} }
  .card{
    background: linear-gradient(180deg, rgba(31,41,55,.75), rgba(17,24,39,.9));
    border:1px solid rgba(255,255,255,.06); border-radius: var(--radius); box-shadow: var(--shadow);
    min-width:0;
  }
  .card h2{
    margin:0; padding:var(--space-3); font-size:var(--fs-18);
    border-bottom:1px solid rgba(255,255,255,.06);
    display:flex; align-items:center; justify-content:space-between; gap:var(--space-2);
  }
  .card .content{ padding:var(--space-3) }
  label{display:block; font-size:var(--fs-14); margin: var(--space-2) 0 var(--space-1)}
  input, select, button, .btn{ font: inherit; }
  .row{display:grid; gap:var(--space-2); grid-template-columns:1fr 1fr}
  .row3{display:grid; gap:var(--space-2); grid-template-columns:1fr 1fr 1fr}
  @media (max-width:680px){ .row, .row3{grid-template-columns:1fr} }

  .input, .select{
    width:100%; padding: clamp(10px, 1.6vw, 12px) clamp(12px, 2vw, 14px);
    border-radius: var(--round); border:1px solid rgba(255,255,255,.1);
    background:#0b1220; color: var(--text);
    outline:none; min-height: var(--tap); font-size: var(--fs-15);
  }
  .input:focus, .select:focus{ border-color: var(--accent); box-shadow: 0 0 0 3px rgba(56,189,248,.2) }
  .note{ font-size:var(--fs-13); opacity:.8; margin-top:6px }
  .toolbar{ display:flex; flex-wrap:wrap; justify-content:flex-start; align-items:center; gap:var(--space-2); }
  #jsonControls{
    display:flex;
    align-items:center;
    gap:var(--space-2);
    overflow:hidden;
    min-height:var(--tap);
    max-width:0;
    opacity:0;
    pointer-events:none;
    transition:max-width .3s ease, opacity .3s ease;
  }
  #jsonControls.show{ max-width:500px; opacity:1; pointer-events:auto; }
  .btn{
    padding: clamp(10px, 1.6vw, 12px) clamp(12px, 2.4vw, 16px);
    border-radius: var(--round); border:1px solid rgba(255,255,255,.12);
    background:linear-gradient(180deg, #0b1220, #0a0f1a);
    color:var(--text); cursor:pointer; transition:.2s transform, .2s box-shadow, .2s background;
    min-height: var(--tap); font-size: var(--fs-15);
    display:inline-flex; align-items:center; justify-content:center; line-height:1;
  }
  .btn:hover{ transform: translateY(-1px); box-shadow: var(--shadow) }
  .btn.primary{ background: linear-gradient(135deg, var(--accent), var(--accent2)); color:#01222a; border:1px solid transparent; font-weight:700 }
  .btn.ok{ background: linear-gradient(135deg, #34d399, #10b981); color:#002114; border:1px solid transparent; font-weight:700 }
  .btn.warn{ background: linear-gradient(135deg, #fbbf24, #f59e0b); color:#2b1a00; border:1px solid transparent; font-weight:700 }
  .btn.danger{ background: linear-gradient(135deg, #f87171, #ef4444); color:#300; border:1px solid transparent; font-weight:700 }
  .btn.ghost{ background: transparent; border-color: rgba(255,255,255,.08) }
  .btn svg{ width:20px; height:20px; display:block; }
  .spacer{flex:1}
  .hidden{display:none !important}

  .tablewrap{ overflow:auto; border-radius: 0 0 var(--radius) var(--radius) }
  .tablewrap.scroll{ max-height: 62vh; overflow:auto; }
  @media (max-width:680px){ .tablewrap.scroll{ max-height: 45vh; } }
  table{ width:100%; border-collapse: collapse; min-width:1000px }
  th, td{
    text-align:right; padding: clamp(10px, 1.6vw, 12px) clamp(8px, 1.6vw, 10px);
    border-bottom:1px solid rgba(255,255,255,.06);
    font-size: var(--fs-14);
  }
  #itemsTable th, #itemsTable td{
    font-size: var(--fs-16);
  }
  thead th{
    position:sticky; top:0; background:rgba(2,6,23,.9); backdrop-filter: blur(6px);
    font-weight:600;
  }
  tbody tr:hover{ background: rgba(3,7,18,.5) }
  .tag{ background: rgba(56,189,248,.15); color: var(--accent);
    padding:2px 8px; border-radius:999px; font-size:var(--fs-12); border:1px solid rgba(56,189,248,.25) }
  .qty{ font-variant-numeric: tabular-nums; font-weight:600 }
  .actions{ display:flex; gap:var(--space-1); justify-content:flex-start; flex-wrap:nowrap }
  .toast{
    position:fixed; inset-inline:0; top:12px; display:grid; place-items:center; z-index:60;
    pointer-events:none;
  }
  .toast > div{
    pointer-events:auto; background:linear-gradient(180deg, #02101a, #08121a);
    border:1px solid rgba(56,189,248,.35);
    padding:var(--space-2) var(--space-3); border-radius:var(--round); box-shadow:var(--shadow); color:#c7f7ff;
    max-width:92%; text-align:center; font-size: var(--fs-14);
  }
  /* Improved search bar layout */
  .searchbar{ display:flex; gap:var(--space-2); align-items:center; margin-bottom:10px; flex-wrap:wrap; justify-content:flex-start; padding:0 var(--space-3); }
  .list-title{ text-align:center; margin-bottom:var(--space-2); }
  .list-info{ margin-bottom:var(--space-2); font-size: var(--fs-14); opacity:.85; padding:0 var(--space-3); text-align:right; }
  .searchbar .input, .searchbar .select{ width:auto; }
  .searchbar .input{ flex:0 0 560px; }
  .searchbar .select{ flex:0 0 200px; }
  .pill{
    border-radius:999px; padding:6px 12px; background:#0b1220; border:1px solid rgba(255,255,255,.08);
    font-size: var(--fs-13); min-height: var(--tap); display:flex; align-items:center;
  }
  .muted{ opacity:.8 } .footer{padding:var(--space-3); text-align:center; opacity:.75; font-size:var(--fs-14)}
  .badge{
    display:inline-flex; align-items:center; gap:6px; padding:6px 12px; border-radius:999px;
    font-size:var(--fs-14); font-weight:700; background:rgba(239,68,68,.2); color:#fecaca; border:1px solid rgba(239,68,68,.4)
  }
  .inline{ display:flex; gap:var(--space-2); align-items:center; flex-wrap:wrap }
  .danger-text{ color:#fecaca } .success-text{ color:#bbf7d0 } .dim{ opacity:.6 }

  /* === قوالب النوافذ المنبثقة (Popup) === */
  .modal-backdrop{
    position: fixed; inset: 0; z-index: 55;
    display: none; background: rgba(2, 6, 23, 0.55); backdrop-filter: blur(6px);
  }
  .modal-backdrop.show{ display: grid; place-items: center; }
  .modal-card{
    width: min(92vw, 980px);
    background: linear-gradient(180deg, rgba(31,41,55,.9), rgba(15,23,42,.95));
    border:1px solid rgba(255,255,255,.08); border-radius: var(--radius);
    box-shadow: var(--shadow); overflow: hidden;
  }
  .modal-head{
    display:flex; align-items:center; justify-content:space-between; gap:var(--space-2);
    padding: var(--space-3); border-bottom:1px solid rgba(255,255,255,.08); font-size: var(--fs-18);
  }
  .modal-body{ padding: var(--space-3); }
  .modal-close{
    border:none; cursor:pointer; background: linear-gradient(180deg, #0b1220, #0a0f1a);
    color: var(--text); border-radius: 10px; padding: 8px 12px;
  }
  .modal-body .tablewrap{ border-radius: var(--radius); }
  .modal-body .tablewrap.scroll{ max-height: min(64vh, 520px); }
  @media (max-width:680px){
    .modal-body{ padding: var(--space-2); }
    .modal-body .tablewrap.scroll{ max-height: 58vh; }
  }

  /* Barcode scanner styles */
  #scanner{
    position:relative;
    width:100%;
    max-width:640px;
    margin:0 auto;
    aspect-ratio:3/2;
    background:#000;
    overflow:hidden;
    border-radius: var(--radius);
  }
  #scanner video,
  #scanner canvas{
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%, -50%);
    width:100%;
    height:100%;
    object-fit:cover;
  }
  #scanner::after{
    content:'';
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%, -50%);
    width:70%;
    height:40%;
    border:2px solid rgba(56,189,248,.8);
    border-radius: var(--round);
    box-sizing:border-box;
  }

  /* تحسين العرض على الأجهزة المحمولة */
  @media (max-width:680px){
    .title{ flex-direction:column; align-items:flex-start; gap:var(--space-2); }
    .title .spacer{ display:none; }
    .toolbar{ width:100%; justify-content:space-between; }
    .searchbar{ flex-direction:column; align-items:stretch; }
    .searchbar .input, .searchbar .select{ flex:1 1 100%; }
  }

